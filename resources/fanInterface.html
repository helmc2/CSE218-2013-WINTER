<!DOCTYPE HTML>
<html>
<head>
<script src="http://code.jquery.com/jquery-1.9.0.min.js"></script>
<script src="epochUtils.js"></script>
<title>Hockey Game Manager</title>
<meta charset="UTF-8" />
<link rel="stylesheet" type="text/css" href="reset.css">
<link rel="stylesheet" type="text/css" href="fan_interface_structure.css">

<script>
var DataToShow = { 
	SHOW_GAME_EVENTS	: 0, 
	SHOW_PLAYER_STATS	: 1, 
	SHOW_TEAMS_INFO		: 2 
	};

var games_ids = {};
var team_names = {};
var currently_showing = DataToShow.SHOW_GAME_EVENTS;


$(document).ready(function() {
  	$("#show-event").click(function() {
		source = document.getElementById('selectGame');
		
		for(var i=(source.options.length-1); i>=0; i--){
			if(source.options[i].selected){		
				$.getJSON("/games/"+games_ids[source.options[i].text]+"/events", function(data,status) 
				{		
					target = document.getElementById('event-box');
					if (data["events"].length == 0)
						target.value = "NO EVENTS RECORDED";
					else 
					{
						target.value = "";
						for (var i = 0; i < data["events"].length; i++) { 
							if (data["events"][i]["event"]["game_clock"]) {
								var time = MillisecToMinSec(data["events"][i]["event"]["game_clock"]);
								var str =  time["mins"] + ":" + time["secs"];
								while(str.length < 7) str+=" ";
								target.value += str + " \t\t\t";
							}
							else
								target.value += "??:??" + "\t\t\t";
							
							var team_str = "";
							if (data["events"][i]["event"]["teamId"])
								team_str = "(" + team_names[data["events"][i]["event"]["teamId"]] + ")";
							
							while (team_str.length < 30) team_str+=" ";
							target.value += team_str+"\t\t\t";
							
							if ("ENTER ICE" === data["events"][i]["event"]["type"])
								target.value += data["events"][i]["event"]["playerName"] + " Enters Ice\t";
							else if ("EXIT ICE" === data["events"][i]["event"]["type"])
								target.value += data["events"][i]["event"]["playerName"] + " Exits Ice\t";	
							else if ("FACEOFF_WON" === data["events"][i]["event"]["type"])
								target.value += data["events"][i]["event"]["playerName"] + " Wins Faceoff\t";	
							else if ("FACEOFF_LOST" === data["events"][i]["event"]["type"])
								target.value += data["events"][i]["event"]["playerName"] + " Loses Faceoff\t";	
							else if ("SHOT" === data["events"][i]["event"]["type"])
								target.value += data["events"][i]["event"]["info"] + "\t";	
							else if ("PENALTY" === data["events"][i]["event"]["type"])
								target.value += data["events"][i]["event"]["info"] + "\t";	
							else if ("HIT" === data["events"][i]["event"]["type"])
								target.value += data["events"][i]["event"]["info"] + "\t";
							else if ("SAVE" === data["events"][i]["event"]["type"])
								target.value += data["events"][i]["event"]["playerName"] + " Gets a Save\t";		
							else if ("Game Start" === data["events"][i]["event"]["type"])
								target.value += "\tStart of Game\t";	
							else if ("Game End" === data["events"][i]["event"]["type"])
								target.value += "\tEnd of Game\t";	
							else if ("Period Start" === data["events"][i]["event"]["type"])
								target.value += "\tStart of Period\t";	
							else if ("Period End" === data["events"][i]["event"]["type"])
								target.value += "\tEnd of Period\t";	
							
							target.value += "\n";
						}
					}
				});		  	
			}	
		}
  	});
});	

window.onload=function() {
	// Populate DOMs
	$.getJSON("/games", function(data,status) 
	{		
		target = document.getElementById('selectGame');
   				
		for (var i = 0; i < data["data"].length; i++) { 
			var dom_txt = getTeamName(data["data"][i]["awayTeam"]) + " @ " + getTeamName(data["data"][i]["homeTeam"]) + " (" + EpochToDate(data["data"][i]["startTime"]) + ")";
			games_ids[dom_txt] = data["data"][i]["id"];
			target.options[target.options.length]=new Option(dom_txt);
		}      
    });	
	$('.player_events_div').hide();
};

function getTeamName(teamId) {
	var teamName = "undefined";
	$.ajax({
		type: 'GET',
		url: "/teams/"+teamId,
		dataType: 'json',
		success: function(data) {teamName = data["name"];},
		async: false
	});	
	team_names[teamId] = teamName;
	return teamName;
}

function setupPage(dataToShow) {
	if (dataToShow === DataToShow.SHOW_GAME_EVENTS && currently_showing !== DataToShow.SHOW_GAME_EVENTS)
	{
		showing_game_events = true;
		$('.player_events_div').hide();
		$('.teams_info_div').hide();
		$('.game_events_div').show();
		currently_showing = DataToShow.SHOW_GAME_EVENTS;
	}
	else if (dataToShow === DataToShow.SHOW_PLAYER_STATS && currently_showing !== DataToShow.SHOW_PLAYER_STATS)
	{
		$('.game_events_div').hide();
		$('.teams_info_div').hide();
		$('.player_events_div').show();
		currently_showing = DataToShow.SHOW_PLAYER_STATS;
	}
	else if (dataToShow === DataToShow.SHOW_TEAMS_INFO && currently_showing !== DataToShow.SHOW_TEAMS_INFO)
	{
		$('.game_events_div').hide();
		$('.teams_info_div').show();
		$('.player_events_div').hide();		
		currently_showing = DataToShow.SHOW_TEAMS_INFO;
	}
}

</script>

</head>

<body>
<div class="box panel" action="/openid" method="POST">
	<fieldset class="boxBody">
	  <label>Fan Interface</label>	  
	</fieldset>
    
	<content>	  
            <td align="left">Games:</td> </br>
            <td align="left"><select name="selectGame" id="selectGame" style="width: 600px;">
            </select></td>
            <button type="submit" id="show-event" class="btn" style="visibility: visible">Update</button>
        	</br> 
            <a onClick=setupPage(DataToShow.SHOW_GAME_EVENTS)>Game Events</a>  |  <a onClick=setupPage(DataToShow.SHOW_PLAYER_STATS)>Player Events</a>  |  <a onClick=setupPage(DataToShow.SHOW_TEAMS_INFO)>Teams Info</a>
            
            <div class="game_events_div">
                <textarea readonly id="event-box" rows="4" style="width: 940px; height: 440px; margin-top: 10px; resize: none;">
                </textarea>          
            </div>
            
             <div class="player_events_div">
             	</br>
             	<td><select name="selectPlayer" id="selectPlayer" style="width: 450px;">
           		</select></td>
                </br>
                <textarea readonly id="game-stats" rows="4" style="width: 465px; height: 400px; margin-top: 10px; resize: none;">
Game Stats:
                </textarea>   
                <textarea readonly id="career-stats" rows="4" style="width: 465px; height: 400px; margin-top: 10px; resize: none;">
Career Stats:
                </textarea>        
            </div>
            
            <div class="teams_info_div">             	
                <textarea readonly id="game-stats" rows="4" style="width: 465px; height: 440px; margin-top: 10px; resize: none;">
Away Team Info:
                </textarea>   
                <textarea readonly id="career-stats" rows="4" style="width: 465px; height: 440px; margin-top: 10px; resize: none;">
Home Team Info:
                </textarea>        
            </div>
	</content>
    
</div>
<footer id="main">
  Hockey Game Manager | CSE 218
</footer>

    <div id="content"></div>

</body>
</html>
